<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>巡检系统首页页面</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui1.css" />
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            background-color: #f5f5f5;
        }

        .aui-bar-nav {
            top: 0;
            z-index: 1;
            background-color: #fff;
            color: #333333;
            font-size: var(--fontsize9);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            height: 59.47vw;
            background: url(../../image/inspection/background.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .aui-bar-nav .aui-btn .aui-iconfont {
            color: #FFF;
            font-weight: 900;
        }

        .aui-card-list {
            background: transparent;
            margin-bottom: 0
        }

        .aui-card-list-header,
        .aui-card-list-footer {
            justify-content: flex-start;
            font-size: var(--fontsize85);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #333333;
            padding: 0.7rem 0.6rem;
        }

        .online {
            width: 0.85rem;
            height: 0.85rem;
            background: url(../../image/inspection/online.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
            margin: auto 0;
            margin-right: 0.1rem;
        }

        .offline {
            background: url(../../image/inspection/offline.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .aui-content {
            padding-left: 3vw;
        }

        .card {
            width: 45.5vw;
            height: 29.9vw;
            background-color: #ffffff;
            border-radius: 0.67vw;
            border: solid 0.13vw #e6e6e6;
            margin-right: 3vw;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fontsize8);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #333333;
            text-align: center;
        }

        .card:active {
            background-color: #f5f5f5;
        }

        .cardRow {
            display: flex;
            margin-bottom: 3.33vw;
        }

        .cardRow:last-child {
            margin-bottom: 0;
        }

        .icon {
            width: 2.73rem;
            height: 2.73rem;
            margin: 0 auto;
            margin-bottom: 0.63rem;
        }

        .task {
            background: url(../../image/inspection/task.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .workOrder {
            background: url(../../image/inspection/workOrder.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .castle {
            background: url(../../image/inspection/castle.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .login {
            background: url(../../image/inspection/login.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }
    </style>
</head>

<body>
    <header class="aui-bar aui-bar-nav" id="header">
        <div class="aui-pull-left aui-btn" tapmode data-action="back">
            <span class="aui-iconfont aui-icon-left"></span>
        </div>
    </header>

    <div class="aui-card-list">
        <div class="aui-card-list-header">
            <div class="online offline"></div>
            <span>在线</span>
        </div>
    </div>

    <div class="aui-content">

        <div class="cardRow">
            <div class="card open-win" tapmode win="./task/myTask">
                <div>
                    <div class="icon task"></div>
                    我的任务
                </div>
            </div>

            <div class="card open-win" tapmode win='./workOrder/myWorkOrder'>
                <div>
                    <div class="icon workOrder"></div>
                    我的工单
                </div>

            </div>
        </div>

        <div class="cardRow">
            <div class="card open-win" tapmode win='./EventBook/EventList'>
                <div>
                    <div class="icon castle"></div>
                    事件簿
                </div>

            </div>

            <div class="card">
                <div>
                    <div class="icon login" tapmode data-action="login"></div>
                    <span>登录上线</span>
                </div>

            </div>
        </div>

        <!-- <ul class="aui-list">

            <li class="aui-list-item open-win" win="org/orgList" tapmode>
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-media">
                        <img src="../../image/systemManage/org.png">
                    </div>
                    <div class="aui-list-item-inner">
                        组织机构
                    </div>
                </div>
            </li>

            <li class="aui-list-item open-win" win="User/UserList">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-media">
                        <img src="../../image/systemManage/user.png">
                    </div>
                    <div class="aui-list-item-inner">
                        用户管理
                    </div>
                </div>
            </li>

            <li class="aui-list-item open-win" win="role/roleList" tapmode>
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-media">
                        <img src="../../image/systemManage/role.png">
                    </div>
                    <div class="aui-list-item-inner">
                        角色管理
                    </div>
                </div>
            </li>

            <li class="aui-list-item open-win" win='../systemManage/contact/contact'>
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-media">
                        <img src="../../image/systemManage/contact.png">
                    </div>
                    <div class="aui-list-item-inner">
                        联系人
                    </div>
                </div>
            </li>

        </ul> -->
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/diy/public.js"></script>
<script type="text/javascript" src="../../script/remote.js"></script>
<script type="text/javascript" src="../../script/moment.js"></script>
<script type="text/javascript" src="../../script/zepto.js"></script>
<script type="text/javascript">
    apiready = function() {
        api.addEventListener({
            name: 'changedFontSize'
        }, function(ret, err) {
            if (ret) {
                changeFontSize();
            }
        });
        aMapLBS = api.require('aMapLBS');
        aMapLBS.configManager({
            accuracy: 'hundredMeters',
            filter: 1
        }, function(ret, err) {});
        api.parseTapmode();
        var header = $api.byId('header');
        // 实现沉浸式状态栏效果
        $api.fixStatusBar(header);
        $api.setStorage('insepProductId', api.pageParam.productId);
        var allTenants = $api.getStorage('allTenants');
        var tenantId = $api.getStorage('tenantId');
        for (var i = 0; i < allTenants.length; i++) {
            if (allTenants[i].tenantId == tenantId) {
                $api.setStorage('orgId', allTenants[i].orgId);
            }
        }
        fnReady();
        if ($api.getStorage('loginInsepection')) {
            $('.login').next().html('退出下线');
            $('.online').removeClass('offline');
            $('.online').next().html('在线');
        } else {
            $('.login').next().html('登录上线');
            $('.online').addClass('offline');
            $('.online').next().html('离线');
        }
    };

    var actionList = {
        'back': function() {
            api.closeWin();
        },
        'login': function() {
            var time = moment().format('HH:mm:ss').split(':');
            var allowLogin = false;
            if (time[0] > '06') {
                allowLogin = true;
            } else if (time[0] == '06') {
                if (time[1] > '00') {
                    allowLogin = true;
                } else if (time[1] == '00') {
                    if (time[2] > '00') {
                        allowLogin = true;
                    }
                }
            }
            if ($api.getStorage('loginInsepection')) {
                $api.rmStorage('loginInsepection');
                fnPost('services/GISInspection/WorkLog/OffWork', {
                    body: JSON.stringify({})
                }, 'application/json', true, false, function(ret, err) {

                })
                $(this).next().html('登录上线');
                $('.online').addClass('offline');
                $('.online').next().html('离线');
            } else {
                if (allowLogin) {
                    $api.setStorage('loginInsepection', true);
                    aMapLBS.singleLocation({
                        timeout: 10
                    }, function(ret, err) {
                        if (ret.status) {
                            var data = {
                                point: ret.lon + ',' + ret.lat
                            }
                            fnPost('services/GISInspection/WorkLog/StartWork', {
                                body: JSON.stringify(data)
                            }, 'application/json', true, false, function(ret, err) {

                            })
                        }
                    });
                    api.sendEvent({
                        name: 'sendLocation',
                        extra: {}
                    });

                    $(this).next().html('退出下线');
                    $('.online').removeClass('offline');
                    $('.online').next().html('在线');
                } else {
                    api.toast({
                        msg: '请在六点后打卡！',
                        duration: 2000,
                        location: 'top'
                    });
                }
            }
        }
    }
</script>

</html>
