<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="../../css/aui1.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/vant.css" />
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
            overflow: auto;
            overflow-x: hidden;
            /*ios滑动添加此样式*/
            -webkit-overflow-scrolling: touch;
        }

        .aui-refresh-pull-arrow {
            top: 20% !important;
        }

        .aui-bar-nav {
            z-index: 1;
            background-color: #fff;
            color: #333333;
            font-size: var(--fontsize9);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
        }

        .aui-bar-nav .aui-btn {
            height: 2.2rem;
        }

        .aui-bar-nav .aui-btn .aui-iconfont {
            color: #333333;
            font-weight: 900;
        }

        header .left {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 70%;
            height: 2.2rem;
            line-height: 2.2rem;
            padding: 0 0.75rem;
            font-size: var(--fontsize9);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #333333;
        }

        header .right {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30%;
            height: 2.2rem;
            line-height: 2.2rem;
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
            -webkit-justify-content: flex-end;
            justify-content: flex-end;
            padding: 0 0.73rem 0 0;
        }

        .left .orgName {
            width: calc( 100% - 1.5rem);
            height: 2.2rem;
            line-height: 2.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            text-align: left;
        }

        .left .orgNameSingle {
            width: 100%;
            height: 2.2rem;
            line-height: 2.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            text-align: left;
        }

        header .left .arrowDiv {
            position: absolute;
            bottom: 0;
            right: 0.75rem;
            width: 1.5rem;
            height: 2.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        header .left .arrow {
            width: 0.7rem;
            height: 0.38rem;
            -webkit-transition: 200ms;
            transition: 200ms;
            pointer-events: none;
        }

        .active {
            -webkit-transform: rotate(180deg);
            transform: rotate(180deg);
        }

        .active_hide {
            -webkit-transform: rotate(-180deg);
            transform: rotate(-180deg);
        }

        header .right .list {
            float: right;
            width: auto;
            height: 0.83rem;
            margin-right: 1.13rem;
        }

        header .right .list:last-child {
            margin-right: 0;
        }

        header .right .list img {
            width: auto;
            height: 0.83rem;
        }

        #changeViewImg {
            width: auto;
            height: 0.83rem;
            cursor: pointer;
        }

        .bannerDiv {
            /*position: relative;*/
            width: 100%;
        }

        .bannerDiv .banner {
            width: 100%;
            /*height: 100%;*/
        }
        /*section {
        width: 100%;
        height: calc( 100% - 227px);
        overflow-x: hidden;
        overflow-y: auto;
        box-sizing: border-box;
        -webkit-overflow-scrolling: touch;
    }*/

        .aui-card-list-header {
            color: #999999;
            font-size: var(--fontsize8) !important;
            padding: 0.6rem;
        }

        .aui-font-size-18 {
            font-size: var(--fontsize8) !important;
        }

        .aui-card-list-header:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            border-bottom: 1px solid #e6e6e6;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            width: 200%;
            height: 200%;
            -webkit-transform: scale(0.5);
            transform: scale(0.5);
            -webkit-transform-origin: left top;
            transform-origin: left top;
            pointer-events: none;
        }

        .aui-card-list-header #ddImg {
            width: 0.93rem;
            height: 0.18rem;
            /*margin: 0 15px 0 7px;*/
            display: inline-block;
        }

        .aui-card-list-header .downArrow {
            width: 0.7rem;
            height: 0.38rem;
            display: inline-block;
            -webkit-transition: 200ms;
            transition: 200ms;
        }

        .aui-card-list-header .imgDiv {
            min-height: 1.2rem;
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
            -webkit-justify-content: center;
            justify-content: center;
        }

        .aui-card-list-header .imgDiv:first-child {
            margin-right: 1.13rem;
        }

        .aui-row.aui-row-padded .aui-col-xs-3 img {
            width: 30px;
            height: 30px;
            margin: 0 auto;
            margin-bottom: 0.5rem
        }

        .aui-row.aui-row-padded .aui-col-xs-3 {
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #333333;
            display: flex;
            justify-content: center;
            padding: 0 !important;
            margin-bottom: 1.02rem;
        }

        .aui-row {
            padding: 1.02rem 0.83rem 0rem 0.83rem !important;
        }

        .appRow {
            display: inline-block;
            /*max-height: 47px;*/
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .largeRow {
            display: inline-block;
            max-height: 55px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .hide {
            display: none;
        }

        .aui-list {
            background-image: none !important;
        }

        .aui-list .aui-list-item:last-child {
            background-image: none !important;
        }

        .aui-list .aui-list-item-text {
            font-size: var(--fontsize8);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #333333;
        }

        .addApp {
            color: #4F79E8;
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            border: 1px solid #4F79E8;
            border-radius: 5rem;
            padding: 0.3rem 0.7rem;
            display: inline-block;
            float: right;
        }

        .addApp:active {
            color: #333333;
            background-color: #bdbdbd;
        }

        .gray {
            -webkit-filter: grayscale(100%);
            -moz-filter: grayscale(100%);
            -ms-filter: grayscale(100%);
            -o-filter: grayscale(100%);
            filter: grayscale(100%);
            filter: gray;
        }

        #ListView .aui-list:after {
            border: none !important;
        }
        /*消息style开始*/

        .aui-tips {
            padding: 0.57rem 0.88rem;
            height: 2rem;
            line-height: 2rem;
            background-color: #fff;
            color: #666;
            width: 100%;
            box-sizing: border-box;
            justify-content: flex-start;
        }

        .aui-tips span {
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0.07rem;
            color: #4f79e8;
        }

        .iconBgs {
            position: relative;
            z-index: 20;
            top: -6px;
            height: 1.4rem;
            font-size: 1.4rem;
            line-height: 1.4rem;
            padding: .5rem;
            border-radius: 50%;
            color: #fff;
            top: -4px!important;
        }

        .aui-grid .aui-badge {
            position: absolute;
            top: 1rem;
            left: 60%;
            z-index: 99;
        }

        #announcement {
            height: 2em;
        }

        #announcement a {
            color: #666;
            text-decoration: none;
            display: block;
            line-height: 2;
            height: 2em;
            text-indent: 0.5em;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .aui-tips .aui-tips-title {
            width: 73%;
            padding: 0;
            /*margin-left: -1.5rem;*/
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0.07rem;
            color: #666666;
        }

        .icon-z {
            width: 0.7rem;
            height: 0.7rem;
            display: inline-block;
            background: url('../../image/main_frame/tongzhi.jpg')no-repeat;
            background-size: 100%;
        }

        .moreDiv {
            /*width: calc(27% - 0.7rem);
        text-align: right;*/
            width: 1.8rem;
            text-align: center;
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0.07rem;
            color: #4f79e8;
        }

        .title_small {
            height: 2.5rem;
        }

        .content_borderContent {
            position: absolute;
            width: 100%;
            /*height: 100%;*/
            margin-top: -0.8rem;
        }

        .ICON_Hide {
            width: 0.8rem;
            height: 0.8rem;
            background: url('../../image/main_frame/hide.jpg')no-repeat;
            background-size: 0.8rem 0.8rem;
            position: absolute;
            margin: 0.6rem 0;
            right: 0
        }

        .ICON_Show {
            width: 0.8rem;
            height: 0.8rem;
            background: url('../../image/main_frame/show.jpg')no-repeat;
            background-size: 0.8rem 0.8rem;
            position: absolute;
            margin: 0.6rem 0;
            right: 0
        }

        .noData {
            width: 100%;
            height: 60vw;
            line-height: 53vw;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0vw;
            color: #0c9ff4;
            text-align: cnt;
            text-align: center;
        }

        .headerLine {
            width: 0.1rem;
            height: 0.8rem;
            margin-right: 0.3rem;
            background-color: #4f79e8;
            display: inline-block;
        }

        .headerDiv {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fontsize8);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
            color: #999999;
        }

        .interval {
            height: 0.75rem;
            width: 100%;
            background: #f0f0f0;
        }

        .content_borderContent .aui-content-padded {
            margin-top: 0rem !important;
        }

        .oAfont {
            font-size: 0.7rem!important;
        }

        .aui-list .aui-list-item-media {
            width: 1rem;
            padding: 0;
            margin-right: 0.65rem;
        }

        .aui-media-list .aui-list-item-inner {
            display: flex;
            align-items: center;
            padding: 0;
            padding-right: 0.75rem;
        }

        #body ul li:last-child .aui-list-item-inner {
            justify-content: flex-end;
        }

        .addAppLi:active {
            background-color: transparent !important;
        }

        #changeDiv {
            width: 1.03rem;
        }

        .approve {
            padding: 0.6rem;
            background-color: #fff;
            margin-bottom: 0.75rem;
        }

        .approve .aui-card-list {
            border: 1px solid #e5e5e5;
            margin-bottom: 0;
        }

        .approve .aui-card-list-header {
            align-items: flex-start;
        }

        .pieTitleDiv {
            width: 40%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .pieTitle {
            color: #333;
            font-weight: 600;
            width: 100%;
            margin-bottom: 2rem;
        }

        .pieTitleBtn {
            border-radius: 1rem;
            background: #ed7d31;
            color: #fff;
            padding: 0 0.75rem;
        }

        .aui-btn.pieTitleBtn:active {
            background: #ed7d31;
            color: #fff;
            opacity: 0.8;
        }

        .pieCharts {
            width: 60%;
            height: 9rem;
        }

        .approve .aui-card-list .aui-card-list-content ul {
            padding: 0.5rem 0;
        }

        .approve .aui-card-list .aui-card-list-content ul>li {
            text-align: center;
            padding-left: 2rem;
            background: url() no-repeat center 0;
            background-size: auto 1.1rem;
            border-right: 1px solid #e5e5e5;
        }

        .approve .aui-card-list .aui-card-list-content ul>li:last-child {
            border-right: none
        }

        .appRow {
            display: inline-block;
            /*max-height: 47px;*/
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .appContent {
            transition: .3s;
        }

        .noticeDiv {
            height: 30px;
            line-height: 30px;
            padding: 0 0.88rem;
            display: flex;
            display: -webkit-box;
            align-items: center;
            background-color: #fff;
        }

        .noticeSwipe {
            height: 30px;
            line-height: 30px;
            width: calc(100% - 3.9rem);
            margin: 0 0.7rem;
        }

        .noticeSwipe .van-swipe-item {
            font-size: var(--fontsize7);
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0.07rem;
            color: #666666;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>

<body>
    <div id="wrap" class="flex-wrap flex-vertical" v-cloak>
        <header class="aui-bar aui-bar-nav" id="navHeader">
            <div class="aui-pull-left aui-btn">
            </div>
            <div class="left">
                <div class="orgNameSingle">{{tenantName}}</div>
            </div>
            <div class="right">
                <div class="list">
                    <img src="../../image/main_frame/sousuo.png" tapmode @click="openSearchApp" />
                </div>
                <div class="list" tapmode @click="changeView()">
                    <img src="../../image/main_frame/changelist.png" v-if="appView == 'app'" />
                    <img src="../../image/main_frame/changeicon.png" v-else/>
                </div>
            </div>
        </header>
        <div class="bannerDiv" id="bannerDiv">
            <img id="banner" class="banner" src="../../image/main_frame/banner2.png">
        </div>

        <!-- 消息开始 -->
        <div class="noticeDiv aui-border-b">
            <i class="aui-iconfont icon-z"></i>
            <van-swipe class="noticeSwipe" vertical autoplay="3000" :show-indicators="false" :touchable="false">
                <van-swipe-item v-if="notices.length == 0">暂无公告消息</van-swipe-item>
                <van-swipe-item v-for="(notice,index) in notices" :key="index" @click="openNoticeDetail(notice)">
                    <span>{{notice.title}}-{{notice.content}}</span>
                </van-swipe-item>
            </van-swipe>
            <div class="moreDiv">
                <span class="aui-list-item-title open-win" win='../message/NoticeMessage' tapmode>更多</span>
            </div>
        </div>
        <!-- 消息结束 -->
        <div id="main" class="flex-con">
            <section id="AppView" v-if="appView == 'app'">
                <div class="aui-card-list" v-for="(app,index1) in appList" :key="index1">
                    <div class="aui-card-list-header"><span class="headerDiv"><div class="headerLine"></div><span>{{app.title}}</span></span>
                        <div class="imgDiv">
                            <div class="imgDiv" tapmode @click="alertClassify(app,index1)"><img src="../../image/main_frame/update.png" id="ddImg" /></div>
                            <div class="imgDiv" tapmode @click="hideAppList(index1)">
                                <img src="../../image/main_frame/downarrow.png" class="downArrow" :class="{active_hide:app.hide}" />
                            </div>
                        </div>
                    </div>
                    <div class="aui-card-list-content appContent" v-show="!app.hide">
                        <div class="aui-row aui-row-padded" v-for="(rows,index2) in app.rowsData" :key="index2">
                            <div class="row" v-for="(row,index3) in rows" :key="index3">
                                <div class="aui-col-xs-3" tapmode @click="openApp(row)" v-if="!row.isAdd && row.isValid">
                                    <div class="appRow">
                                        <img :src="row.logoUrl" :class="{gray:!row.isValid}" onerror="this.src='../../image/main_frame/default1.png'" />{{row.productName}}
                                    </div>
                                </div>
                                <div class="aui-col-xs-3" v-if="row.isAdd">
                                    <div class="appRow">
                                        <img src="../../image/main_frame/addApp.png" tapmode @click="addApp(app.id)" />添加应用
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="ListView" v-else>
                <div class="aui-card-list" v-for="(app,index1) in appList" :key="index1">
                    <div class="aui-card-list-header"><span>{{app.title}}</span>
                        <div class="imgDiv">
                            <div class="imgDiv" tapmode @click="alertClassify(app,index1)" data-param="{{app}}"><img src="../../image/main_frame/update.png" id="ddImg" /></div>
                            <div class="imgDiv" tapmode @click="hideAppList(index1)">
                                <img src="../../image/main_frame/downarrow.png" class="downArrow" :class="{active_hide:app.hide}" />
                            </div>
                        </div>
                    </div>
                    <div class="aui-card-list-content appContent" v-show="!app.hide">
                        <ul class="aui-list aui-media-list">
                            <li class="aui-list-item aui-list-item-middle" tapmode @click="openApp(item)" v-for="(item,index2) in app.applications" :key="index2" v-if="!item.isAdd">
                                <div class="aui-media-list-item-inner">
                                    <div class="aui-list-item-media imgIcon">
                                        <img :src="item.logoUrl" :class="{gray:!item.isValid}" onerror="this.src='../../image/main_frame/default1.png'" />
                                    </div>
                                    <div class="aui-list-item-inner">
                                        <div class="aui-list-item-text">{{item.productName}}</div>
                                    </div>
                                </div>
                            </li>
                            <li class="aui-list-item aui-list-item-middle addAppLi">
                                <div class="aui-media-list-item-inner">
                                    <div class="aui-list-item-inner">
                                        <div class="addApp" tapmode @click="addApp(app.id)">添加应用</div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/diy/public.js"></script>
<script type="text/javascript" src="../../script/remote.js"></script>
<script type="text/javascript" src="../../script/aui-popup-new.js"></script>
<script type="text/javascript" src="../../script/zepto.js"></script>
<script type="text/javascript" src="../../script/hammer.min.js"></script>
<script type="text/javascript" src="../../script/diy/template.js"></script>
<script type="text/javascript" src="../../script/aui-collapse.js"></script>
<script type="text/javascript" src="../../script/vue/fastclick.min.js"></script>
<script type="text/javascript" src="../../script/vue/vue.min.js"></script>
<script type="text/javascript" src="../../script/vue/vant.min.js"></script>
<script type="text/template" id='OAUnreadList'>
    {{each list value i}}
    <li class="aui-list-item aui-margin-l-20 open-win" win='../work/OA_UnRead' param='{{value}}'>
        <div class="aui-list-item-inner">
            <div class="aui-list-item-title oAfont">{{i+1}}、{{value.subjectTitle.substring(0,10)}}-{{value.subjectTime.substring(0,10)}}</div>
        </div>
    </li>
    {{/each}}
    <li class="aui-list-item aui-padded-r-15 aui-border-t open-win" win='../work/OA_UnRead' id="appMoreUrl1">
        <div class="aui-list-item-inner">
            <a href="#" class="oAfont">查看详情 <i class="aui-iconfont aui-icon-right aui-collapse-arrow"></i></a>
        </div>
    </li>
</script>
<script type="text/template" id='OAnewMeetList'>
    {{each list value i}}
    <li class="aui-list-item aui-padded-l-15 aui-border-b autoLi">
        <div class="aui-list-item-inner">
            <div class="aui-row">
                <div class="aui-col-xs-1"><span class="Dot_Y"></span></div>
                <div class="aui-col-xs-3"><span class="header_font">会议名称:</span></div>
                <div class="aui-col-xs-8">{{value.meetingSubject}}</div>
            </div>
            <div class="aui-row">
                <div class="aui-col-xs-1"><span class="Dot_no"></span></div>
                <div class="aui-col-xs-3 OAconcent"><span class="header_font ">会议地点:</span></div>
                <div class="aui-col-xs-8 ">{{value.roomName}}</div>
            </div>
            <div class="aui-row">
                <div class="aui-col-xs-1"><span class="Dot_no"></span></div>
                <div class="aui-col-xs-3"><span class="header_font">会议时间:</span></div>
                <div class="aui-col-xs-8">{{ value.meetingBeginTim.substring(0,10)}}</div>
            </div>
        </div>
    </li>
    {{/each}}
    <li class="aui-list-item aui-padded-r-15  open-win" win='../work/OA_UnRead' param='2'>
        <div class="aui-list-item-inner">
            <a href="#" class="oAfont">查看详情 <i class="aui-iconfont aui-icon-right aui-collapse-arrow"></i></a>
        </div>
    </li>
</script>
<script type="text/template" id='OAContactsList'>
    {{each list value i}}
    <li class="aui-list-item aui-padded-l-15 aui-border-b autoLi">
        <div class="aui-list-item-inner">
            <div class="aui-row">
                <div class="aui-col-xs-1"><span class="Dot_Y"></span></div>
                <div class="aui-col-xs-4"><span class="header_font aui-font-size-18">最近</span></div>

            </div>
            <div class="aui-row">
                <div class="aui-col-xs-1"><span class="Dot_no"></span></div>
                <div class="aui-col-xs-11"><span class="header_font oAfont">{{value.name}}[部门:{{value.classify}}  电话:{{value.phoneNum}}]</span></div>
            </div>
        </div>
    </li>
    {{/each}}
    <li class="aui-list-item aui-padded-r-15  open-win" win='../work/OA_UnRead' param='4'>
        <div class="aui-list-item-inner">
            <a href="#" class="oAfont">查看详情 <i class="aui-iconfont aui-icon-right aui-collapse-arrow"></i></a>
        </div>
    </li>
</script>

<script type="text/javascript">
    var frame = "";
    var moduleView = "";
    var moduleHide = "";
    var applicationsView = "";
    var applicationsHide = "";
    var winH;
    var FNScanner;
    var isSHowContent = true;
    var Number_i = 0;
    var HasLoad = 0;
    var LoadNumber = 0;
    // fnIntVue(); //初始化vue实例
    // Origami.fastclick(document.body) //消除vue的ios端点击延迟
    apiready = function() {
        api.addEventListener({
            name: 'changedFontSize'
        }, function(ret, err) {
            if (ret) {
                changeFontSize();
            }
        });
        if ($api.getStorage('isAppOrList') == undefined) {
            $api.setStorage('isAppOrList', 'app');
        }
        fnIntVue(); //初始化vue实例
        Origami.fastclick(document.body) //消除vue的ios端点击延迟
        api.parseTapmode();
        var header = $api.byId('navHeader');
        var banner = $api.byId('bannerDiv');
        FNScanner = api.require('FNScanner');

        // 实现沉浸式状态栏效果
        $api.fixStatusBar(header);

        // 计算header和nav元素的高度
        headerH = $api.offset(header).h;

        bannerH = $api.offset(banner).h;
        $api.setStorage('isAppOrList', 'app');
        fnReady();
        getGisInfo();
        GetScadaDomin();
        operationDom();

        // 下拉刷新
        api.setRefreshHeaderInfo({
            visible: true,
            bgColor: '#F0F0F0',
            textColor: '#999999',
            textDown: '下拉刷新...',
            textUp: '松开刷新...',
            showTime: true
        }, function(ret, err) {
            setTimeout(function() {
                api.sendEvent({
                    name: 'refreshMain',
                });
                location.reload();
                api.refreshHeaderLoadDone();
            }, 500);
        });

        // 监听是否修改了服务器地址
        api.addEventListener({
            name: 'changeApiUrl'
        }, function(ret, err) {
            if (ret) {
                location.reload();
            }
        });

        api.addEventListener({
            name: 'addClassify' //新增分类
        }, function(ret, err) {
            if (ret) {
                var body = {
                    body: JSON.stringify({
                        title: ret.value.title,
                        notDelete: false
                    })
                }
                fnPost('services/app/Home/InsertCustomizeTitle', body, 'application/json', true, false, function(ret, err) {
                    if (ret && ret.success) {
                        var item = ret.result;
                        item['applications'] = [];
                        MainVue.appData.push(item);
                        $api.setStorage('appData', MainVue.appData);
                    }
                })
            }
        });

        api.addEventListener({
            name: 'editClassify' //修改分类
        }, function(ret, err) {
            if (ret) {
                var body = {
                    body: JSON.stringify({
                        title: ret.value.title,
                        id: ret.value.id,
                        sort: ret.value.sort
                    })
                }
                var index = ret.value.index;
                fnPost('services/app/Home/UpdateCustomizeTitle', body, 'application/json', true, true, function(ret, err) {
                    if (ret && ret.success) {
                        MainVue.appData[index].title = ret.result.title;
                        $api.setStorage('appData', MainVue.appData);
                    }
                })
            }
        });

        api.addEventListener({
            name: 'deleteClassify' //删除分类
        }, function(ret, err) {
            if (ret) {
                var index = ret.value.index;
                var id = ret.value.id;
                fnGet('services/app/Home/DeleteCustomizeTitle?Id=' + id + '', {}, true, function(ret, err) {
                    if (ret && ret.success) {
                        MainVue.appData.splice(index, 1);
                        $api.setStorage('appData', MainVue.appData);
                    }
                })
            }
        });

        api.addEventListener({
            name: 'refreshAppList' //添加应用后刷新首页应用分类列表
        }, function(ret, err) {
            if (ret) {
                MainVue.getAppList();
            }
        });


        //安卓点击内容区滚动时，屏蔽下拉刷新造成的页面滑动
        $('#main').on('touchstart', function() {
            //触摸开始，屏蔽滑动
            api.setFrameAttr({
                name: 'main_frame',
                bounces: false
            });
        });
        $('#main').on('touchmove', function() {
            //触摸滚动，屏蔽滑动
            api.setFrameAttr({
                name: 'main_frame',
                bounces: false
            });
        });
        $('#main').on('touchend', function() {
            //触摸结束，释放滑动
            api.setFrameAttr({
                name: 'main_frame',
                bounces: true
            });
        });
    };

    function fnIntVue() {
        window.MainVue = new Vue({
            el: "#wrap",
            data: {
                tenantName: $api.getStorage('tenantName') == undefined ? "" : $api.getStorage('tenantName'),
                showTenantSelect: false,
                appView: $api.getStorage('isAppOrList') == undefined ? 'app' : $api.getStorage('isAppOrList'),
                appData: $api.getStorage('appData') == undefined ? [] : $api.getStorage('appData'),
                notices: [],
            },
            methods: {
                openTenantSelect() { //多租户时点击名字旁的箭头可切换租户
                    this.showTenantSelect = !this.showTenantSelect;
                    if (this.showTenantSelect) {
                        api.openFrame({
                            name: 'orgSelect_frame',
                            url: './orgSelect_frame.html',
                            rect: {
                                x: 0,
                                y: headerH,
                                w: 'auto',
                                h: 'auto'
                            },
                            pageParam: {
                                name: 'test'
                            },
                            bounces: false,
                            bgColor: 'rgba(0,0,0,0.38)',
                        });
                    } else {
                        api.sendEvent({
                            name: 'closeOrgSelectFrm',
                        });
                    }
                },
                getTenantInfo() { //获取租户名字
                    fnGet('services/app/Home/GetLoginInfo', {}, false, (ret, err) => {
                        if (ret && ret.success) {
                            this.tenantName = ret.result.tenantInfo.tenantName;
                            $api.setStorage('tenantName', this.tenantName);
                        }
                    })
                },
                openSearchApp() { //打开搜索应用界面
                    api.openWin({
                        name: 'searchApp',
                        url: './searchApp.html',
                        pageParam: {
                            name: 'test'
                        }
                    });
                },
                changeView() { //应用列表切换显示（栅格/列表）
                    if (this.appView == 'list') {
                        this.appView = 'app'
                    } else {
                        this.appView = 'list'
                    }
                    $api.setStorage('isAppOrList', this.appView);
                },
                getAppList() { //获取应用列表
                    fnGet('services/app/Home/GetHome', {}, false, (ret, err) => {
                        if (ret) {
                            if (ret.success) {
                                if (ret.result != null) {
                                    getAppMapSet();
                                    var url = apiUrl;
                                    this.appData = ret.result.templateTitles;
                                    for (var i = 0; i < this.appData.length; i++) {
                                        this.appData[i]['hide'] = false;
                                        var appData = this.appData[i].applications;
                                        if (appData != null) {
                                            for (var j = 0; j < appData.length; j++) {
                                                appData[j]['logoUrl'] = url + appData[j].productIcon;
                                            }
                                        }
                                    }
                                    $api.setStorage('appData', this.appData);
                                }
                            }
                        }
                    })
                },
                hideAppList(i) { //点击箭头隐藏应用
                    this.appData[i].hide = !this.appData[i].hide;
                    this.appData = JSON.parse(JSON.stringify(this.appData));
                },
                alertClassify(app, index) { //弹出操作应用分类的弹窗
                    api.openFrame({
                        name: 'classify_frame',
                        url: './classify_frame.html',
                        rect: {
                            x: 0,
                            y: 0,
                            w: 'auto',
                            h: 'auto'
                        },
                        pageParam: {
                            classify: app,
                            index: index
                        },
                        bounces: false,
                        bgColor: 'rgba(0,0,0,0.6)',
                    });
                },
                addApp(id) { //添加应用
                    api.openWin({
                        name: 'addApp',
                        url: './addApp.html',
                        slidBackEnabled: false,
                        pageParam: {
                            id: id
                        }
                    });
                },
                openApp(data) { //打开应用
                    if (data.openMobile) {
                        if ((data.iosPackage != "" && data.iosPackage != null) || (data.androidPackage != "" && data.androidPackage != null)) {
                            if (data.iosPackage != "" && data.iosPackage != null) {
                                if (api.systemType == 'ios') {
                                    api.openApp({
                                        iosUrl: data.iosPackage,
                                        appParam: {},
                                    }, function(ret, err) {

                                    });
                                }
                            } else if (data.androidPackage != "" && data.androidPackage != null) {
                                //异步返回结果：
                                api.appInstalled({
                                    appBundle: data.androidPackage
                                }, function(ret, err) {
                                    if (ret.installed) {
                                        api.openApp({
                                            androidPkg: data.androidPackage,
                                            appParam: {},
                                        }, function(ret, err) {

                                        });

                                    } else {
                                        //应用未安装
                                        api.toast({
                                            msg: '应用未安装',
                                            duration: 2000,
                                            location: 'top'
                                        });
                                    }
                                });
                            }
                        } else if (data.mobileWebUrl != "" && data.mobileWebUrl != null) {
                            if (data.mobileWebUrl.indexOf('http') != -1) {
                                api.openWin({
                                    name: 'OA',
                                    url: './OA.html',
                                    pageParam: {
                                        url: data.mobileWebUrl,
                                        productId: data.productId,
                                        coding:data.coding
                                    }
                                });
                            } else {
                                var winName = data.mobileWebUrl;
                                var index = winName.lastIndexOf('/');
                                var index2 = winName.indexOf('.html');
                                if (index != -1 && index2 != -1) {
                                    winName = winName.substring(index + 1, index2);
                                }
                                api.openWin({
                                    name: winName,
                                    url: data.mobileWebUrl,
                                    pageParam: {
                                        productId: data.productId
                                    }
                                });
                            }
                        }
                    }
                },
                getNotice() { //获取首页滚动播放的公告消息
                    fnGet('services/app/Message/GetMessageList?MessageType=2&PageIndex=1&MaxResultCount=3', {}, false, function(ret, err) {
                        if (ret) {
                            if (ret.success) {
                                MainVue.notices = ret.result.items;
                            }
                        }
                    })
                },
                openNoticeDetail(notice) { //单击公告进入公告详情
                    api.openWin({
                        name: 'NoticeDetails',
                        url: '../message/NoticeDetails.html',
                        pageParam: notice
                    });
                },
            },
            mounted: function() {
                this.getNotice();
                this.getTenantInfo();
                this.getAppList();
            },
            computed: {
                appList: function() {
                    var data = JSON.parse(JSON.stringify(this.appData));
                    var url = apiUrl;
                    for (var i = 0; i < data.length; i++) {
                        data[i]['rowsData'] = [];
                        if (data[i].applications != null) {
                            var appData = data[i].applications;
                            for (var j = 0; j < appData.length; j++) {
                                appData[j]['logoUrl'] = url + appData[j].productIcon;
                            }
                            var addData = {
                                isAdd: true
                            }
                            appData.push(addData);
                            if (appData.length % 4 == 0) {
                                rows = (appData.length + 1) / 4;
                            } else {
                                rows = parseInt(appData.length / 4) + 1;
                            }
                            for (var k = 0; k < rows; k++) {
                                var arr = [];
                                for (var m = 4 * k; m < 4 * (k + 1); m++) {
                                    if (appData[m] != null) {
                                        arr.push(appData[m]);
                                    }
                                }
                                data[i].rowsData.push(arr);
                            }
                        } else {
                            data[i].applications = [];
                            var appData = data[i].applications;
                            var addData = {
                                isAdd: true
                            }
                            appData.push(addData);
                            if (appData.length % 4 == 0) {
                                rows = (appData.length + 1) / 4;
                            } else {
                                rows = parseInt(appData.length / 4) + 1;
                            }
                            for (var k = 0; k < rows; k++) {
                                var arr = [];
                                for (var m = 4 * k; m < 4 * (k + 1); m++) {
                                    if (appData[m] != null) {
                                        arr.push(appData[m]);
                                    }
                                }
                                data[i].rowsData.push(arr);
                            }
                        }
                    }
                    return data
                }
            }
        })
    }

    var GisUrl;
    var Config;

    function getGisInfo() {
        var url1 = 'services/GIS/GisCommService/GetMapApiUrl';
        fnGet(url1, {}, false, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    GisUrl = ret.result;
                    $api.setStorage('GisUrl', GisUrl);
                } else {
                    api.toast({
                        msg: 'GIS接口地址请求错误',
                        duration: 2000,
                        location: 'bottom'
                    });
                }
            }
            api.hideProgress();
        });


        var url2 = 'services/GIS/MapConfigService/GetMapConfig';
        fnGet(url2, {}, false, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    Config = ret.result[0];
                    $api.setStorage('Config', Config);
                } else {
                    api.toast({
                        msg: 'GIS接口地址请求错误',
                        duration: 2000,
                        location: 'bottom'
                    });
                }
            }
            api.hideProgress();
        });

        var body = {
            body: JSON.stringify({
                code: 'GIS.NetEdit.Point'
            })
        };
        fnPost('services/GIS/GisCommService/HasRight', body, 'application/json', true, false, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    $api.setStorage('GISAdd', 'true');
                }
            }
            api.hideProgress();
        });

    }

    function GetScadaDomin() {
        var url = 'services/Report/Scada/GetScadaDomin';
        fnGet(url, {}, false, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    var GetScadaDomin = ret.result;
                    $api.setStorage('GetScadaDomin', GetScadaDomin);
                } else {
                    api.toast({
                        msg: 'GIS接口地址请求错误',
                        duration: 2000,
                        location: 'bottom'
                    });
                }
            }
            api.hideProgress();
        });
    }
</script>

</html>
